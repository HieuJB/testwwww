import{c as se}from"./CVfOd3DW.js";import{d as ae,c4 as ne,r as k,w as le,t as W,e as m,o as C,c as Y,h as t,v as G,bG as H,i as R,k as J,bN as j,V as ie,E as re,j as ce,l as ue}from"./DWGr-Zqp.js";import{a as q,A as z}from"./yrA-jQKW.js";import{s as de}from"./DpHY5NEn.js";import{a as me}from"./BE5IFATL.js";import{u as pe}from"./j282xpNN.js";import"./C5R4H73m.js";import"./FqhJEqRe.js";import"./Dzd5zbn4.js";import"./DRizsLw2.js";import"./3bue5Vy1.js";import"./D2n4AUx3.js";import"./DVfTkWZM.js";import"./BN1EXK5Q.js";import"./cGgey60k.js";const ve={class:"txtBox"},_e=t("span",{class:"icon iconfont icon-font-username"},null,-1),he={class:"txtBox"},fe=t("span",{class:"icon iconfont icon-font-password"},null,-1),ge=t("span",{id:"pwdEye",class:"icon iconfont icon-font-hide invisible"},null,-1),ke=t("div",{id:"lg_msg"},null,-1),ye=ae({__name:"LoginForm.client",emits:["closeModalLogin","openModalRegister"],setup(Q,{emit:M}){const u=ne(),h=de(),T=pe(),n=me(),S=k(!1),d=k(""),i=k(""),b=k(!1),o=k([]),O=M,X=async()=>{var r,e,l,p,v,_,s,y,f,L,$,F,N,B,P,U,V,I,K,D,A;try{const{data:a,pending:E,error:c,refresh:Ce}=await q(z.AUTH.LOGIN,{method:"POST",body:{nick_name:d.value,password:i.value}},"$JKyOLI6eHf");let w="";c!=null&&c.value&&(typeof((l=(e=(r=c.value)==null?void 0:r.data)==null?void 0:e.data)==null?void 0:l.detail)=="string"?(o.value=[{msg:(_=(v=(p=c.value)==null?void 0:p.data)==null?void 0:v.data)==null?void 0:_.detail}],(s=o.value)==null||s.forEach(g=>w+=g==null?void 0:g.msg)):(o.value=(L=(f=(y=c.value)==null?void 0:y.data)==null?void 0:f.data)==null?void 0:L.detail,($=o.value)==null||$.forEach(g=>w+=g==null?void 0:g.msg))),w&&u.add({type:"error",text:w}),((F=a==null?void 0:a.value)==null?void 0:F.status)==="success"&&(m("accessToken").value=(N=a==null?void 0:a.value)==null?void 0:N.access_token,m("refreshToken").value=(B=a==null?void 0:a.value)==null?void 0:B.refresh_token,h.accessToken=(P=a==null?void 0:a.value)==null?void 0:P.access_token,b.value?(m("userNickname").value=d.value,m("userPassword").value=i.value):(m("userNickname").value=null,m("userPassword").value=null),T.authenticateUser(),Z((U=a==null?void 0:a.value)==null?void 0:U.access_token),u.add({type:"success",text:"Đăng nhập thành công."}),re(()=>{b.value||oe(),O("closeModalLogin",!0)}))}catch(a){(I=(V=a==null?void 0:a.response)==null?void 0:V._data)!=null&&I.detail?o.value=[{msg:(D=(K=a==null?void 0:a.response)==null?void 0:K._data)==null?void 0:D.detail}]:o.value=[{msg:"Có lỗi xẩy ra trong quá trình đăng nhập."}];let E="";o!=null&&o.value&&((A=o.value)==null||A.forEach(c=>E+=c==null?void 0:c.msg),u.add({type:"error",text:E}))}},Z=async r=>{var e,l,p,v,_;try{const{data:s,pending:y,error:f,refresh:L}=await q(z.USER.ME,{headers:{Authorization:`${r}`}},"$1WP9YrV12w");s!=null&&s.value&&(h.userData=s==null?void 0:s.value,m("userData").value=JSON.stringify(s==null?void 0:s.value))}catch(s){(l=(e=s==null?void 0:s.response)==null?void 0:e._data)!=null&&l.detail?o.value=[{msg:(v=(p=s==null?void 0:s.response)==null?void 0:p._data)==null?void 0:v.detail}]:o.value=[{msg:"error."}];let y="";o!=null&&o.value&&((_=o.value)==null||_.forEach(f=>y+=f==null?void 0:f.msg),u.add({type:"error",text:y}))}},ee=r=>{var l,p,v,_,s;o.value=[];let e="";if(!((l=String(d.value))!=null&&l.trim()))return e="Tài khoản là bắt buộc.",o.value.push({msg:e}),u.add({type:"error",text:e}),!1;if(!((p=String(i.value))!=null&&p.trim()))return e="Mật khẩu là bắt buộc.",o.value.push({msg:e}),u.add({type:"error",text:e}),!1;if(((_=(v=String(i.value))==null?void 0:v.trim())==null?void 0:_.length)<8)return e="Mật khẩu ít nhất 8 ký tự.",o.value.push({msg:e}),u.add({type:"error",text:e}),!1;if(!((s=o.value)!=null&&s.length))return!0},x=r=>{var e;ee(),(e=o.value)!=null&&e.length||X()},te=()=>{O("openModalRegister",!0)},oe=()=>{d.value="",i.value=""};return le(n,()=>{n!=null&&n.isOpenLoginForm&&(S.value=n==null?void 0:n.isOpenLoginForm)}),W(()=>{const r=m("userNickname").value,e=m("userPassword").value;r&&e&&(d.value=r,i.value=e,b.value=!0)}),(r,e)=>(C(),Y("form",{id:"lg_form",name:"lg_form",method:"post",onSubmit:ie(x,["prevent"])},[t("div",ve,[_e,G(t("input",{id:"nickname","onUpdate:modelValue":e[0]||(e[0]=l=>J(d)?d.value=l:null),type:"text",placeholder:"Tài khoản",title:"Tài khoản",autocomplete:"name",autofocus:""},null,512),[[H,R(d)]])]),t("div",he,[fe,G(t("input",{id:"password","onUpdate:modelValue":e[1]||(e[1]=l=>J(i)?i.value=l:null),autocomplete:"on",type:"password",placeholder:"Mật khẩu",title:"Mật khẩu",onKeyup:j(x,["enter"]),onKeydown:j(x,["enter"])},null,544),[[H,R(i)]]),ge]),ke,t("div",{class:"row"},[t("div",{class:"col-12"},[t("div",{class:"button--max button--success col-12 inline",onClick:x},"Đăng nhập ")])]),t("div",{class:"row"},[t("div",{class:"col-12"},[t("div",{class:"button button--max col-12 inline",onClick:te},"Đăng ký")])])],32))}}),be=se(ye),xe={ref:"modalLogin",class:"modal fade",id:"modal_login",tabindex:"-1","aria-labelledby":"modal_login_label","aria-hidden":"true"},we={class:"modal-dialog modal-dialog-centered"},Me={class:"modal-content"},Te=t("div",{class:"modal-title",id:"modal_login_label"},"Đăng nhập",-1),Se={id:"login_body",class:"regBox"},Le=t("span",{class:""},null,-1),Ee=t("div",{class:"mh2"}," Đăng nhập ",-1),Je={__name:"ModalLogin",emits:["openModalRegister"],setup(Q,{emit:M}){const u=M,h=k(null),T=k(!0);W(()=>{h.value=new bootstrap.Modal(document.getElementById("modal_login"),{}),h.value.show()});const n=async()=>{h.value&&h.value.hide()},S=()=>{n(),setTimeout(()=>{u("openModalRegister")},200)};return(d,i)=>{const b=be;return C(),Y("div",xe,[t("div",we,[t("div",Me,[t("div",{class:"modal-header d-none"},[Te,t("button",{type:"button",class:"btn-close",onClick:n,"aria-label":"Close"})]),t("div",Se,[t("div",{class:"title"},[Le,Ee,t("span",{class:"iconfont icon-close",onClick:n})]),R(T)?(C(),ce(b,{key:0,onCloseModalLogin:n,onOpenModalRegister:S})):ue("",!0)])])])],512)}}};export{Je as default};
